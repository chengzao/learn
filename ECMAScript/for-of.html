<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>for-of</title>
</head>

<body>
    <dl>
        <dt>1</dt>
        <dt>2</dt>
        <dt>3</dt>
        <dt>4</dt>
        <dt>5</dt>
    </dl>
</body>
<script>
    // 一个数据结构只要部署了Symbol.iterator属性，就被视为具有 iterator 接口，
    // 就可以用for...of循环遍历它的成员。
    // 也就是说，for...of循环内部调用的是数据结构的Symbol.iterator方法。

    // for...of循环可以使用的范围: Array, Set, Map, 些类似数组的对象（比如arguments对象、DOM NodeList 对象）、Generator 对象，以及字符串


    const arr = ['red', 'green', 'blue'];

    for (let v of arr) {
        console.log(v); // red green blue
    }

    const obj = {};
    obj[Symbol.iterator] = arr[Symbol.iterator].bind(arr);

    for (let v of obj) {
        console.log(v); // red green blue
    }

    var arr = ['a', 'b', 'c', 'd'];
    // for...in循环，只能获得对象的键名
    for (let a in arr) {
        console.log(a); // 0 1 2 3
    }
    // for...of循环，允许遍历获得键值
    for (let a of arr) {
        console.log(a); // a b c d
    }
    //for...of循环调用遍历器接口，数组的遍历器接口只返回具有数字索引的属性
    let arr = [3, 5, 7];
    arr.foo = 'hello';

    for (let i in arr) {
        console.log(i); // "0", "1", "2", "foo"
    }

    for (let i of arr) {
        console.log(i); //  "3", "5", "7"
    }


    console.log('----------array---------');

    var arr = [1, 2, 3, 4];
    for (var i of arr) {
        console.log('i: ' + i);
    }

    console.log('----------string---------');

    var str = 'abcdd';
    for (var i of str) {
        console.log('i :' + i);
    }

    console.log('----------string2---------');

    //Set 对象可以有效的去重
    var str2 = 'abcdd';
    var uniqueWords = new Set(str2);

    for (var i of uniqueWords) {
        console.log(' i : ' + i);
    }

    console.log('----------object.keys-----------');
    // for-of循环不支持普通对象，但如果你想迭代一个对象的属性，你可以用for-in循环或内建的Object.keys()方法

    // 输出对象自身可以枚举的值
    var obj = { 'name': 'zhangsan', 'age': 10 };

    for (var key of Object.keys(obj)) {
        console.log(key + ": " + obj[key]);
    }

    console.log('----------DOM NodeList------');

    var doms = document.getElementsByTagName('dl')[0];
    var lis = doms.children;
    for (var item of lis) {
        console.log(item)
    }

    // Set 和 Map 结构也原生具有 Iterator 接口，可以直接使用for...of循环
    var engines = new Set(["Gecko", "Trident", "Webkit", "Webkit"]);
    for (var e of engines) {
        console.log(e);
    }
    // Gecko
    // Trident
    // Webkit

    var es6 = new Map();
    es6.set("edition", 6);
    es6.set("committee", "TC39");
    es6.set("standard", "ECMA-262");
    for (var [name, value] of es6) {
        console.log(name + ": " + value);
    }
    // edition: 6
    // committee: TC39
    // standard: ECMA-262

    // Set 结构遍历时，返回的是一个值，而 Map 结构遍历时，返回的是一个数组
    let map = new Map().set('a', 1).set('b', 2);
    for (let pair of map) {
        console.log(pair);
    }
    // ['a', 1]
    // ['b', 2]

    for (let [key, value] of map) {
        console.log(key + ' : ' + value);
    }
    // a : 1
    // b : 2

    //计算生成的数据结构
    //ES6 的数组、Set、Map 都部署了以下三个方法，调用后都返回遍历器对象
    // entries() 返回一个遍历器对象，用来遍历[键名, 键值]组成的数组。对于数组，键名就是索引值；对于 Set，键名与键值相同。Map 结构的 Iterator 接口，默认就是调用entries方法。
    // keys() 返回一个遍历器对象，用来遍历所有的键名。
    // values() 返回一个遍历器对象，用来遍历所有的键值。
    let arr = ['a', 'b', 'c'];
    for (let pair of arr.entries()) {
        console.log(pair);
    }
    // [0, 'a']
    // [1, 'b']
    // [2, 'c']


    //类似数组的对象
    // 并不是所有类似数组的对象都具有 Iterator 接口，一个简便的解决方法，就是使用Array.from方法将其转为数组
    // 字符串
    let str = "hello";

    for (let s of str) {
        console.log(s); // h e l l o
    }

    // DOM NodeList对象
    let paras = document.querySelectorAll("p");

    for (let p of paras) {
        p.classList.add("test");
    }

    // arguments对象
    function printArgs() {
        for (let x of arguments) {
            console.log(x);
        }
    }
    printArgs('a', 'b');
    // 'a'
    // 'b'

    let arrayLike = { length: 2, 0: 'a', 1: 'b' };
    // 报错
    for (let x of arrayLike) {
        console.log(x);
    }

    // 正确
    for (let x of Array.from(arrayLike)) {
        console.log(x);
    }


    //对象
    // 对于普通的对象，for...of结构不能直接使用，会报错，必须部署了 Iterator 接口后才能使用。
    // 但是，这样情况下，for...in循环依然可以用来遍历键名
    let es6 = {
        edition: 6,
        committee: "TC39",
        standard: "ECMA-262"
    };

    for (let e in es6) {
        console.log(e);
    }
    // edition
    // committee
    // standard

    for (let e of es6) {
        console.log(e);
    }
    // TypeError: es6[Symbol.iterator] is not a function

    // 使用Object.keys方法将对象的键名生成一个数组，然后遍历这个数组。
    for (var key of Object.keys(someObject)) {
        console.log(key + ': ' + someObject[key]);
    }
    // 使用 Generator 函数将对象重新包装一下
    function* entries(obj) {
        for (let key of Object.keys(obj)) {
            yield [key, obj[key]];
        }
    }

    for (let [key, value] of entries(obj)) {
        console.log(key, '->', value);
    }
    // a -> 1
    // b -> 2
    // c -> 3


    // 与其他遍历语法的比较
    for (var index = 0; index < myArray.length; index++) {
        console.log(myArray[index]);
    }
    //无法中途跳出forEach循环，break命令或return命令都不能奏效
    myArray.forEach(function (value) {
        console.log(value);
    });
    //for...in循环可以遍历数组的键名
    // 数组的键名是数字，但是for...in循环是以字符串作为键名“0”、“1”、“2”等等
    // for...in循环不仅遍历数字键名，还会遍历手动添加的其他键，甚至包括原型链上的键

    for (var index in myArray) {
        console.log(myArray[index]);
    }
    //for of : 它可以与break、continue和return配合使用
    //for of : 提供了遍历所有数据结构的统一操作接口
    for (var n of fibonacci) {
        if (n > 1000)
            break;
        console.log(n);
    }
</script>

</html>